<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>Idle Miner</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: url("assets/bg.png") no-repeat center center fixed;
  background-size: cover;
  min-height: 100vh;
  color: #fff;
  display: flex;
  justify-content: center;
  align-items: center;
}

.boost-timer {
  margin-top: 10px;
  font-weight: bold;
  color: gold;
  text-shadow: 0 0 5px #000;
}

.hidden { display: none; }

.box {
  background: #1b1f3b;
  padding: 20px;
  border-radius: 12px;
  width: 320px;
  text-align: center;
}

.character {
  width: 120px;
  height: 120px;
  background: #2ec1cc;
  border-radius: 50%;
  margin: 20px auto;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 48px;
}

@keyframes mine {
  0%   { transform: rotate(0deg); }
  25%  { transform: rotate(-10deg); }
  50%  { transform: rotate(0deg); }
  75%  { transform: rotate(10deg); }
  100% { transform: rotate(0deg); }
}

.mining { animation: mine 1s infinite; }
.booster { box-shadow: 0 0 20px 5px gold; animation: mine 0.5s infinite; }

button {
  width: 100%;
  padding: 10px;
  margin-top: 10px;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  cursor: pointer;
}

.btn-primary { background: #3498db; color: #fff; }
.btn-upgrade { background: #9b59b6; color: #fff; }
.btn-ad { background: #f1c40f; color: #000; }
.btn-logout { margin-top: 15px; background: #444; color: #fff; border: none; padding: 8px 14px; border-radius: 6px; cursor: pointer; }
.btn-logout:hover { background: #666; }

#walletBox {
  position: fixed;
  top: 15px;
  right: 15px;
  background: rgba(0,0,0,0.7);
  color: #fff;
  padding: 12px 16px;
  border-radius: 10px;
  font-size: 14px;
  z-index: 2;
  box-shadow: 0 0 10px #000;
}
#walletBox button {
  margin-top: 6px;
  width: 100%;
  padding: 6px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}
#walletBox.hidden { display: none; }

.coin-display {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 8px;
}
.coin-icon {
  width: 28px;
  height: 28px;
  object-fit: contain;
  animation: coinFloat 1.5s infinite ease-in-out;
}
@keyframes coinFloat {
  0%   { transform: translateY(0); }
  50%  { transform: translateY(-6px); }
  100% { transform: translateY(0); }
}
</style>
</head>

<body>
<div id="walletBox" class="hidden">
  üíº Carteira  
  <div>Saldo: <span id="walletBalance">0.000</span> coins</div>
  <button onclick="withdraw()">üí∏ Sacar</button>
</div>

<!-- LOGIN -->
<div id="loginBox" class="box">
  <h2>Login An√¥nimo</h2>
  <button class="btn-primary" onclick="loginAnonymous()">Entrar</button>
</div>

<!-- GAME -->
<div id="gameBox" class="box hidden">
  <h3 id="playerName"></h3>
  <div id="character" class="character">‚õèÔ∏è</div>

  <div class="coin-display">
    <img src="assets/coin.png" class="coin-icon">
    <h2 id="coins">0.000</h2>
  </div>
  <div class="small"><span id="rate">0.025</span> coins / segundo</div>

  <button onclick="collectCoins()">üì• Coletar</button>
  <button class="btn-ad" onclick="watchAd()">üé• Assistir an√∫ncio (2x)</button>

  <hr>
  <div id="boostTimer" class="boost-timer hidden">
    ‚ö° Boost ativo: <span id="boostTime">30</span>s
  </div>

  <h4>üõí Loja</h4>
  <button class="btn-upgrade" onclick="buyUpgrade('pickaxe')">
    ‚õèÔ∏è Picareta (+0.005) <span id="pickaxeInfo"></span>
  </button>
  <button class="btn-upgrade" onclick="buyUpgrade('training')">
    üìö Treinamento (+5%) <span id="trainingInfo"></span>
  </button>
  <button class="btn-upgrade" onclick="buyUpgrade('booster')">
    ‚ö° Booster Premium (+5s) <span id="boosterInfo"></span>
  </button>
  <button onclick="logout()" class="btn-logout">üö™ Sair</button>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAcglBjm9DYGKFSp5hYk71HX3paNYrXtsE",
  authDomain: "idle-miner-game.firebaseapp.com",
  projectId: "idle-miner-game",
  storageBucket: "idle-miner-game.firebasestorage.app",
  messagingSenderId: "569609751940",
  appId: "1:569609751940:web:01a7b7b6208e185f56e1d1"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

let player = { wallet:0, username:"Player", coins:0, rate:0.025, lastActive:Date.now(), lastAdTime:0, upgrades:{pickaxe:0,training:0,booster:0} };
let multiplier = 1, boosterActive=false, boostRemaining=0, boostInterval=null;
let currentUserId = null;

/* LOGIN AN√îNIMO */
function loginAnonymous(){
  auth.signInAnonymously().then(userCred => {
    currentUserId = userCred.user.uid;
    loadPlayerFromBackend();
  }).catch(err => alert("Erro no login an√¥nimo: "+err.message));
}

async function loadPlayerFromBackend(){
  const ref = db.collection("players").doc(currentUserId);
  const doc = await ref.get();
  if(doc.exists){
    player = doc.data();
    multiplier = 1 + (player.upgrades.training * 0.05);
  } else {
    await ref.set(player);
  }
  enterGame();
  updateUI();
  updateWallet();
}

/* FUN√á√ïES PRINCIPAIS */
function enterGame(){
  document.getElementById("walletBox").classList.remove("hidden");
  document.getElementById("playerName").innerText = player.username;
  document.getElementById("loginBox").classList.add("hidden");
  document.getElementById("gameBox").classList.remove("hidden");
  startMiningAnimation();
}

async function logout(){
  await auth.signOut();
  document.getElementById("gameBox").classList.add("hidden");
  document.getElementById("loginBox").classList.remove("hidden");
  document.getElementById("walletBox").classList.add("hidden");
}

function saveGame(){
  if(!currentUserId) return;
  player.lastActive = Date.now();
  db.collection("players").doc(currentUserId).set(player);
}

/* UI */
function updateUI(){
  document.getElementById("coins").innerText = player.coins.toFixed(3);
  document.getElementById("rate").innerText = (player.rate*multiplier).toFixed(3);
  document.getElementById("pickaxeInfo").innerText = `(Lvl ${player.upgrades.pickaxe} | ${getUpgradeCost("pickaxe").toFixed(1)})`;
  document.getElementById("trainingInfo").innerText = `(Lvl ${player.upgrades.training} | ${getUpgradeCost("training").toFixed(1)})`;
  document.getElementById("boosterInfo").innerText = `(Lvl ${player.upgrades.booster} | ${getUpgradeCost("booster").toFixed(1)})`;
}

function updateWallet(){
  document.getElementById("walletBalance").innerText = player.wallet.toFixed(3);
}

function startMiningAnimation(){
  document.getElementById("character").classList.add("mining");
}
</script>
</body>
</html>
